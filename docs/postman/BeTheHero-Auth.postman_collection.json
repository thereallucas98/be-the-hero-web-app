{
  "info": {
    "name": "BeTheHero - Auth",
    "description": "Coleção para testar endpoints de autenticação do BeTheHero. Use variáveis de ambiente para trocar baseUrl e dados de teste.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000"
    },
    {
      "key": "testFullName",
      "value": "João Silva"
    },
    {
      "key": "testEmail",
      "value": "joao@test.com"
    },
    {
      "key": "testPassword",
      "value": "12345678"
    },
    {
      "key": "partnerFullName",
      "value": "Maria ONG"
    },
    {
      "key": "partnerEmail",
      "value": "maria@ong.org"
    },
    {
      "key": "partnerPassword",
      "value": "senha1234"
    },
    {
      "key": "cityPlaceId",
      "value": ""
    },
    {
      "key": "workspaceId",
      "value": ""
    },
    {
      "key": "memberId",
      "value": ""
    },
    {
      "key": "petId",
      "value": ""
    },
    {
      "key": "imageId",
      "value": ""
    }
  ],
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Register - Success (GUARDIAN)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"{{testFullName}}\",\n  \"email\": \"{{testEmail}}\",\n  \"password\": \"{{testPassword}}\"\n}"
            },
            "url": "{{baseUrl}}/api/auth/register",
            "description": "Registro com role GUARDIAN (default)"
          }
        },
        {
          "name": "Register - PARTNER_MEMBER",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"{{partnerFullName}}\",\n  \"email\": \"{{partnerEmail}}\",\n  \"password\": \"{{partnerPassword}}\",\n  \"role\": \"PARTNER_MEMBER\"\n}"
            },
            "url": "{{baseUrl}}/api/auth/register",
            "description": "Registro como PARTNER_MEMBER"
          }
        },
        {
          "name": "Register - Validation Error (400)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"J\",\n  \"email\": \"email-invalido\",\n  \"password\": \"123\"\n}"
            },
            "url": "{{baseUrl}}/api/auth/register",
            "description": "Payload inválido - deve retornar 400 com details"
          }
        },
        {
          "name": "Register - Email Already in Use (409)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"{{testFullName}}\",\n  \"email\": \"{{testEmail}}\",\n  \"password\": \"{{testPassword}}\"\n}"
            },
            "url": "{{baseUrl}}/api/auth/register",
            "description": "E-mail duplicado - executar 2x com mesmo email para obter 409"
          }
        },
        {
          "name": "Register - Admin Blocked (403)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Admin\",\n  \"email\": \"admin@test.com\",\n  \"password\": \"{{testPassword}}\",\n  \"role\": \"ADMIN\"\n}"
            },
            "url": "{{baseUrl}}/api/auth/register",
            "description": "Role ADMIN/SUPER_ADMIN bloqueado publicamente"
          }
        },
        {
          "name": "Login - Success",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{testEmail}}\",\n  \"password\": \"{{testPassword}}\"\n}"
            },
            "url": "{{baseUrl}}/api/auth/login",
            "description": "Login com credenciais válidas. Define cookie bth_access."
          }
        },
        {
          "name": "Login - Success (Partner)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{partnerEmail}}\",\n  \"password\": \"{{partnerPassword}}\"\n}"
            },
            "url": "{{baseUrl}}/api/auth/login",
            "description": "Login como PARTNER_MEMBER"
          }
        },
        {
          "name": "Login - Validation Error (400)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"email-invalido\",\n  \"password\": \"123\"\n}"
            },
            "url": "{{baseUrl}}/api/auth/login",
            "description": "Payload inválido - deve retornar 400 com details"
          }
        },
        {
          "name": "Login - Invalid Credentials (401)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{testEmail}}\",\n  \"password\": \"senha-errada\"\n}"
            },
            "url": "{{baseUrl}}/api/auth/login",
            "description": "Senha incorreta - mesma mensagem que user inexistente"
          }
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [],
            "url": "{{baseUrl}}/api/auth/logout",
            "description": "Remove o cookie bth_access"
          }
        },
        {
          "name": "Me (get current user)",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api/me",
            "description": "Retorna usuário autenticado + contexto (memberships, adminCities). Requer cookie bth_access - execute Login primeiro."
          }
        }
      ]
    },
    {
      "name": "Workspaces",
      "item": [
        {
          "name": "Create Workspace",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"ONG Amigos dos Bichos\",\n  \"type\": \"ONG\",\n  \"description\": \"Organização sem fins lucrativos de proteção animal na região metropolitana.\",\n  \"cityPlaceId\": \"{{cityPlaceId}}\",\n  \"lat\": -23.5505,\n  \"lng\": -46.6333,\n  \"addressLine\": \"Rua Exemplo, 123\",\n  \"neighborhood\": \"Centro\",\n  \"zipCode\": \"01310-100\"\n}"
            },
            "url": "{{baseUrl}}/api/workspaces",
            "description": "Cria workspace + location (primary) + city coverage + member OWNER. Requer PARTNER_MEMBER. Execute Login (Partner) antes."
          }
        },
        {
          "name": "My Workspaces",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api/workspaces/my",
            "description": "Lista workspaces em que o usuário logado é membro (role, status, localização primária, cidade). Execute Login primeiro."
          }
        },
        {
          "name": "Get Workspace by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api/workspaces/{{workspaceId}}",
            "description": "Retorna detalhes do workspace (localização primária, cidades de cobertura, membros paginados). Acesso: membro, ADMIN com cobertura ou SUPER_ADMIN. Use workspaceId de My Workspaces."
          }
        },
        {
          "name": "Get Workspace by ID - Paginated Members",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api/workspaces/{{workspaceId}}?membersPage=1&membersPerPage=20",
            "description": "Mesmo que Get Workspace by ID com paginação explícita de membros (20/página)."
          }
        },
        {
          "name": "Patch Workspace (Update)",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"ONG Amigos dos Bichos (atualizado)\",\n  \"description\": \"Nova descrição do workspace.\",\n  \"website\": \"https://amigosdosbichos.org.br\",\n  \"instagram\": \"@amigosdosbichos\"\n}"
            },
            "url": "{{baseUrl}}/api/workspaces/{{workspaceId}}",
            "description": "Atualiza dados básicos do workspace (nome, descrição, contatos, links). Acesso: OWNER/EDITOR, ADMIN com cobertura ou SUPER_ADMIN. Atualização parcial - só campos enviados."
          }
        },
        {
          "name": "Create Pet",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Rex\",\n  \"description\": \"Cachorro dócil e carinhoso, castrado, vacinado. Adora crianças e outros pets.\",\n  \"species\": \"DOG\",\n  \"sex\": \"MALE\",\n  \"size\": \"MEDIUM\",\n  \"ageCategory\": \"ADULT\",\n  \"energyLevel\": \"MEDIUM\",\n  \"independenceLevel\": \"LOW\",\n  \"environment\": \"BOTH\",\n  \"adoptionRequirements\": \"Ter espaço e tempo para passeios diários.\"\n}"
            },
            "url": "{{baseUrl}}/api/workspaces/{{workspaceId}}/pets",
            "description": "Cadastra pet para adoção. Apenas OWNER/EDITOR. Pet inicia com status DRAFT. Obrigatório: name, description, species, sex, size, ageCategory."
          }
        },
        {
          "name": "Remove Workspace Member",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": "{{baseUrl}}/api/workspaces/{{workspaceId}}/members/{{memberId}}",
            "description": "Remove (desativa) membro do workspace. Soft delete (isActive=false). Apenas OWNER. OWNER não pode remover a si mesmo se for o único. Use memberId de Get Workspace by ID ou Add Workspace Member."
          }
        },
        {
          "name": "Add Workspace Member",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{testEmail}}\",\n  \"role\": \"EDITOR\"\n}"
            },
            "url": "{{baseUrl}}/api/workspaces/{{workspaceId}}/members",
            "description": "Adiciona membro ao workspace por e-mail. Apenas OWNER pode adicionar. Role: OWNER, EDITOR ou FINANCIAL. Usuário deve existir no sistema."
          }
        },
        {
          "name": "Patch Workspace Location",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"cityPlaceId\": \"{{cityPlaceId}}\",\n  \"lat\": -23.5505,\n  \"lng\": -46.6333,\n  \"addressLine\": \"Rua Nova, 456\",\n  \"neighborhood\": \"Jardins\",\n  \"zipCode\": \"01415-001\"\n}"
            },
            "url": "{{baseUrl}}/api/workspaces/{{workspaceId}}/location",
            "description": "Atualiza localização primária do workspace (cidade, endereço, coordenadas). Adiciona cidade à cobertura se não existir. Acesso: OWNER/EDITOR, ADMIN com cobertura ou SUPER_ADMIN. cityPlaceId deve ser do tipo CITY."
          }
        }
      ]
    },
    {
      "name": "Pets",
      "item": [
        {
          "name": "List Pets (Public)",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{baseUrl}}/api/pets?page=1&perPage=20",
            "description": "Lista pets públicos (APPROVED, ativos). Sem auth. Query: cityPlaceId (uuid), species (DOG, CAT, etc), page (default 1), perPage (max 20). Ordenação: mais recentes primeiro. Retorna coverImage e workspace básico."
          }
        },
        {
          "name": "Remove Pet Image",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": "{{baseUrl}}/api/pets/{{petId}}/images/{{imageId}}",
            "description": "Remove imagem do pet. OWNER/EDITOR. Se cover removida, próxima por position vira cover. Não remove última imagem se pet PENDING_REVIEW. 204."
          }
        },
        {
          "name": "Update Pet Image",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"position\": 2,\n  \"isCover\": true\n}"
            },
            "url": "{{baseUrl}}/api/pets/{{petId}}/images/{{imageId}}",
            "description": "Atualiza position e/ou isCover da imagem. Se isCover=true, desmarca outras. Troca de position é transacional. Use imageId de Add Pet Image."
          }
        },
        {
          "name": "Add Pet Image",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"url\": \"https://example.supabase.co/storage/v1/object/public/bethehero-pet-images/pets/{{petId}}/photo.jpg\",\n  \"storagePath\": \"pets/{{petId}}/photo.jpg\",\n  \"position\": 1,\n  \"isCover\": true\n}"
            },
            "url": "{{baseUrl}}/api/pets/{{petId}}/images",
            "description": "Registra imagem do pet (arquivo já em storage). storagePath deve começar com pets/{petId}/. Max 5 imagens. Se isCover=true, desmarca cover anterior."
          }
        },
        {
          "name": "Submit Pet for Review",
          "request": {
            "method": "POST",
            "header": [],
            "url": "{{baseUrl}}/api/pets/{{petId}}/submit-for-review",
            "description": "Envia pet DRAFT para revisão (PENDING_REVIEW). Apenas OWNER/EDITOR. Requer: dados mínimos, 1-5 imagens, exatamente 1 isCover. Workspace ativo e não REJECTED."
          }
        },
        {
          "name": "Update Pet (PATCH)",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Rex (atualizado)\",\n  \"description\": \"Descrição atualizada do pet.\"\n}"
            },
            "url": "{{baseUrl}}/api/pets/{{petId}}",
            "description": "Atualiza dados do pet. Apenas OWNER/EDITOR do workspace. Não altera status/approvedAt. Bloqueado se pet ADOPTED. Update parcial."
          }
        }
      ]
    },
    {
      "name": "Admin",
      "item": [
        {
          "name": "Approve Pet",
          "request": {
            "method": "POST",
            "header": [],
            "url": "{{baseUrl}}/api/admin/pets/{{petId}}/approve",
            "description": "Aprova pet em PENDING_REVIEW. SUPER_ADMIN ou ADMIN com cobertura da cidade do workspace. Pet deve ter 1-5 imagens, 1 isCover. Workspace ativo. Retorna pet atualizado (status APPROVED, approvedAt, approvedByUserId)."
          }
        },
        {
          "name": "Reject Pet",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reviewNote\": \"Imagens de baixa qualidade. Favor enviar fotos mais nítidas.\"\n}"
            },
            "url": "{{baseUrl}}/api/admin/pets/{{petId}}/reject",
            "description": "Rejeita pet em PENDING_REVIEW. SUPER_ADMIN ou ADMIN com cobertura. reviewNote obrigatório. Workspace ativo. Transacional + AuditLog REJECT com motivo em metadata. Retorna pet (status REJECTED, approvedAt, approvedByUserId)."
          }
        }
      ]
    }
  ]
}
